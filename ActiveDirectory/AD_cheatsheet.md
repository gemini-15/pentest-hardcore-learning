---
title: AD cheat-sheet
updated: 2023-11-05 21:59:06Z
created: 2023-11-05 21:57:58Z
---

## Powershell cheat-sheet
- ***to retrieve information about an AD user :*** `get-ADuser` 
-  ***to retrieve information about a service account :*** `get-ADserviceaccount`
	- adding `-properties *` to get all the informations about the account.
	-  for [GMSA](https://www.dsinternals.com/en/retrieving-cleartext-gmsa-passwords-from-active-directory/)
-  ***Credential to usable variable in Powershell :*** 
	-  The password could be a `System.Security.SecureString` object (if not it must be converted).
```powershell 
	$cred = New-Object System.Management.Automation.PScredential "username",$secpwd
```
- Send a command when we can't have a direct access :
```powershell
Invoke-Command -ComputerName 127.0.0.1 -cred $cred -SCriptBlock { whoami }
```

## Powerview cheat-sheet

We can import Powerview after downloading it by using powershell:
```powershell
Import-Module .\PowerView.ps1
```

### Information gathering in a Domain 

#### Basic information about the domain 
Returns information about the DomainController, `PdcRolerOwner`, name etc... 
```powershell
get-NetDomain
```

#### Retrieving the list Operating systems 
```powershell
Get-NetComputer
```

#### Retrieving the list of users
Returns the list of users in the domain using LDAP through .NET classes. 
```powershell
get-NetUser
```

We can filter the attributes by piping it with `select`:
```powershell
get-NetUser | select cn,pwdlastset,lastlogon
```

#### Retrieving the list of groups 
Returns the list of groups in the domain using LDAP through .NET classes. 
```powershell
get-NetGroup
```

We can filter the attributes by piping it with `select`:
```powershell
# returning the name of all the groups
get-NetGroup | select cn

# returning the members of a specific group
get-NetGroup "Group name" | select member 
```
#### Retrieving the list Operating systems and hostnames

```powershell
# Returns the list of computers and OSs
Get-NetComputer

# Returns the OS and hostnames
Get-NetComputer | select operatingsystem,dnshostname
```

#### Determine admin permissions of user in a domain
To see if our user has any administrative permissions on any computer in the domain we can use `Find-LocalAdminAccess` from ***PowerView***. 

> What does the function do? 
> The powerview command uses `OpenServiceW` function that connects to the Service Control Manager (SCM) (maintains a DB with SC_MANAGER_ALL_ACCESS which requires admin privs). If the connection is a success => our user has admin privs on that machine. 

```powershell
Find-LocalAdminAccess
```
## Requesting the DC
### User enumeration using kerbrute
If we have to check a user that we found, we can do so using kerbrute :
```bash
kerbrute userenum --dc <IP> -d <domain.com> <users_file.txt>
```

It should also check for pre-auth hashes if there is, so that we can use in asreproast attack or crack the hashes. 

## Sysinternals tools cheat-sheet 
