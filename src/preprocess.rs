use crate::app::{App, AppResult};
use std::{fs::{self, File}, io::Read, path::{Path, PathBuf}};
use markdown::{
    to_mdast,
    mdast::Node
};


pub struct TreeNodes {
    nodes: Vec<Node>,
    
}

impl TreeNodes {
    /// Initializes the TreeNodes object
    pub fn init() -> Self {
        TreeNodes {
            nodes: Vec::new()
        }
    }

    /// Preprocess file and adds markdown nodes into 
    /// the treeNodes vector. 
    pub fn preprocess_file(&mut self, filename: &Path) {
        self.nodes.push(parse_md_to_nodes(filename).unwrap());
    }
}



/// Parses a Markdown file into Multiple nodes. 
/// 
fn parse_md_to_nodes(filename: &Path) -> AppResult<Node> {
    let mut file = match File::open(&filename) {
        Err(e) => panic!("{} => couldn't open file : {}",e, filename.display()),
        Ok(file) => file
    };  

    let mut s = String::new();
    match file.read_to_string(&mut s) {
        Err(e) => panic!("{} => couldn't read file : {}",e, filename.display()),
        Ok(_) => println!("File read.")
    }

    Ok(to_mdast(&s, &markdown::ParseOptions::default())?)
}



