# SMB cheatsheet and notes

## Notes

SMB (port 445) and netBIOS (port 139) are two seperate protocols. 
- NetBIOS : enables applications on different computers to communicate with each other across a LAN (Layer 5 OSI: session).
- SMB can work without NetBIOS (but enabled for backward compatibility), thus enumeration of SMB implies the two. 


## Information gathering 

### nmap and SMB scripts 
- We can list the SMB scripts by typing :
```bash
ls -1 /usr/share/nmap/scripts/smb*
```

- We can use SMB scripts on nmap :
```bash
nmap -p139,445 --script="smb* and not brute" <IP>
```

- OS discovery : 
```bash
nmap --script-args=unsafe=1 --script smb-os-discovery <IP> 
```
OS discovery enumeration script provides interesting informations related to [AD-DS](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview). 

### nbtscan

Specialized tool for specifically identifying NetBIOS information. 
```bash
sudo nbtscan -r <IP>/<Range>
```

### Testing users in SMB 


## Information gathering - Windows
Enumerating SMB shares in Windows can be done with : `net view`
```powershell
net view \\dc01 /all
```
Administrative shares ends with a dollar sign (like ADMIN$)

## CrackmapExec and SMB
### Brute-forcing credentials with crackmapexec

If we have a set of users and passwords, we can check is they are valid against a machine that has SMB port open with `crackmapexec`. 
```bash
crackmapexec smb <IP> -u usernames.txt -p passwords.txt --continue-on-success
```
### Exploring shares 
> Condition : Have an Authenticated access.
```bash
crackmapexec smb <IP> -u user -p "password" --shares

## references

[https://www.hackingarticles.in/smb-penetration-testing-port-445/](https://www.hackingarticles.in/smb-penetration-testing-port-445/)