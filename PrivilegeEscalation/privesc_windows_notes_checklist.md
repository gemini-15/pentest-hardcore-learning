# Windows privilege escalation

- [ ] checking the `windows/win.ini` file 
- Key information to leverage :
    - [ ] Username and hostname
    - [ ] Group memeberships of the current user
    - [ ] Existing users and groups
    - [ ] OS version and architecture
    - [ ] Network information
    - [ ] Installed applications
    - [ ] running processes

## Windows privileges and Access control mechanisms
### Security Identifier (SID)
Example:
```
S-1-5-21-1336799502-1441772794-948155058-1001
```
- S : is for indicating that the string is an SID.
- 1 : version of the SID implementation
- 5 : Determines the identifier authority. 5 is the most common and represents the *NT Authority* and is used for local, domain users and groups. 
- the rest : represents the sub-authorities of the identifier authority. domain identifier and relative identifier (RID). 
- 1001 defines that relative identifier. 

### Access Token 
When a user authentifies, an access token is assigned to that user. The token describes various information that defines the *security context*. 

when a user starts a process, a token is assigned to the objects related. This token is called the *primary token* and specifies which permissions the process or threads have when interacting with another object and is a copy of the access token of the user. 

A thread can also have an *impersonate token*. And provides a different security context than the process that owns the thread. 

### Mandatory Integrity Control

Mandatory Integrity are *integrity levels* to control acess to securable objects (hierarchies of trust).

[https://learn.microsoft.com/en-us/windows/win32/secauthz/mandatory-integrity-control](https://learn.microsoft.com/en-us/windows/win32/secauthz/mandatory-integrity-control)

### User Account Control
UAC is a security feature that protects the OS by running most applications with standard user privs. It leverages two tokens, a standard user token, and an administrator token which is the consent prompt on Windows. 

## Information Gathering 

### Key informations about a system
#### Get the **username** and **hostname** 
```powershell
whoami
```
#### Listing all the groups a user
```powershell
whoami /groups
```

#### Obtain a list of all local users (show also if enabled with description). 
```powershell
net user
# Or 
Get-LocalUser
```
#### Obtaining a list of all local groups 
```powershell
net localgroup
# Or
Get-LocalGroup
```
#### Listing the members of a group 
```powershell
Get-LocalGroupMember <groupName>
```

#### The OS information can be obtained using 
```powershell
systeminfo
```
#### Network information 
```powershell
ipconfig /all
```
#### Checking Routing table 
```powershell
route print
```
#### showing all active connections 
```powershell
netstat -ano
```
#### Checking installed applications
To list both 32-bit and 64-bit applications we query two registry keys in the *Windows Registry* with the *Get-ItemProperty* Cmdlet :
```powershell
# 32bits
Get-ItemProperty "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname

#64bits
Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname
```
This output might not be completed, an additional search should be done on the *Program Files* and *Downloads* directories. 

#### Indentifying running processes

```powershell
Get-Process
```
