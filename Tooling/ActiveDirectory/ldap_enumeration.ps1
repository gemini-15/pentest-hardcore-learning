

function LDAPSearch {
    param (
        [string]$LDAPQuery
    )
# Retrieving the Domain Object : 
# Return example
    # Forest                  : example.com
    # DomainControllers       : {DC1.example.com}
    # Children                : {}
    # DomainMode              : Unknown
    # DomainModeLevel         : 7
    # Parent                  :
    # PdcRoleOwner            : DC1.example.com
    # RidRoleOwner            : DC1.example.com
    # InfrastructureRoleOwner : DC1.example.com
    # Name                    : example.com
    $domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()

    # Retrieve the name of the PdcRoleOwner
    $PDC = $domainObj.PdcRoleOwner.Name

    # Retrieving the distinguished name 
    $DN = ([adsi]'').distinguishedName

    # LDAP 
    $LDAP = "LDAP://$PDC/$DN"

    # Search functionality
    $directoryEntry = New-Object System.DirectoryServices.DirectoryEntry($LDAP)

    $directorySearcher = New-Object System.DirectoryServices.DirectorySearcher($directoryEntry)

    # Filters
    # $directorySearcher.filter="samAccountType=805306368"

    return $directorySearcher.FindAll()
}

# Source : Offsec pen-200