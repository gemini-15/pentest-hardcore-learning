$listenerPort = 8080 # Specify the port you want the server to listen on
$listenerPrefix = "http://*:$listenerPort/"
$webRoot = "C:\Users\jason\Documents" # Path to the directory you want to serve

$listener = New-Object System.Net.HttpListener
$listener.Prefixes.Add($listenerPrefix)
$listener.Start()
Write-Host "Listening on $listenerPrefix"

while ($listener.IsListening) {
    $context = $listener.GetContext()
    $request = $context.Request
    $response = $context.Response
    $requestedFile = [System.IO.Path]::Combine($webRoot, $request.Url.LocalPath.TrimStart('/'))

    if (Test-Path $requestedFile -PathType Leaf) {
        try {
            $fileBytes = [System.IO.File]::ReadAllBytes($requestedFile)
            $response.ContentLength64 = $fileBytes.Length
            $response.OutputStream.Write($fileBytes, 0, $fileBytes.Length)
        }
        catch {
            $response.StatusCode = 500
            Write-Host "Error serving file: $_"
        }
    }
    else {
        $response.StatusCode = 404
        Write-Host "File not found: $requestedFile"
    }

    $response.OutputStream.Close()
}

$listener.Stop()

## to be ran with powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File server.ps1